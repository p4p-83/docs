Part of yesterday's idea likely came from study for my radio engineering exam, where IQ demodulation was examinable. Part also probably came from reading my textbook ([AoE](https://ubiq.co.nz/products/the-art-of-electronics)), which discussers choppers and synchronous detection (such as employed by a lock-in amplifier) on several occasions.

On these grounds, I revisited the textbook. As it so happens, it not only discusses the concepts but also recommends a few off-the-shelf parts.

- Generic ICs include the [AD630](https://www.analog.com/en/products/ad630.html), <https://www.analog.com/en/products/ad633.html,> and [AD734](https://www.analog.com/en/products/ad734.html). The AD630 works for square waves, and the other are intended for the multiplication of sine waves (further explained below).
- Hamamatsu makes ICs that do this specifically for optical interruptors. These integrate carrier generation, LED driver, a photodiode with preamplifier, and a lock-in amplifier all on chip. All you need to supply is the LED itself. AoE lists their [S4282](https://www.hamamatsu.com/eu/en/product/optical-sensors/photo-ic/light-modulation-photo-ic/S4282-51.html), S4289, S6809, S6846, S6886, and [S7136](https://www.hamamatsu.com/eu/en/product/optical-sensors/photo-ic/light-modulation-photo-ic/S7136.html) series devices as worth looking into here.

AoE points out that sine waves are slightly better than square waves, because sine waves are perfectly orthogonal. Square waves are not: a lock in detector working with square waves will accept the carrier frequency as well as all its odd harmonics. (You can prove this graphically pretty easily.) This is unlikely to pose an issue in our case.

The bandwidth of the lock-in is set by the bandwidth of the RC filter (or whatever filter is used) after the multiplier. This works because the multiplier frequency-shifts the input, and then the RC filter low-passes the dc component, which now corresponds exactly with the carrier. However, noise and interference will also go through the multiplier and also get frequency shifted, meaning that they will also show up at the RC filter. These will be sinusoids of a low frequency, although not zero, and therefore if the RC filter has wide enough bandwidth, these signals will show up in the output too. Basically, it's as if the low pass filter was a bandpass filter way up at a much higher frequency. Ideally, you narrow the bandwidth as much as possible, but you can't go too far with this: the RC filter also determines the response time of the lock-in amplifier. Therefore, for a fast response, you need a wider bandwidth of this filter and this directly corresponds to a greater bandwidth of input signal, and less rejection. Therefore I will place the carrier frequency up quite high, well away from any common interference sources, and open the bandwidth only just enough to get an acceptably quick response. (A bandwidth of, say, 100 Hz around a carrier of 10 kHz goes between 9.9 kHz and 10.1 kHz (?). That's a pretty narrow slice of the spectrum. This is why the frequency shift is desirable â€” there's a lot more spectrum up there. I'm less concerned with noise than I am with interference, and so it should be possible to adjust the frequency until I find some clear region of the spectrum.)