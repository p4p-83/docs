My newpandoc project generator works alright to create PDF exports of this logbook.

1. Create a new directory.
2. Open in a shell (or better, VS Code) and run `newpandoc` to copy in all the template files.
3. Manually copy in all the .md files (eg this one).
4. Fix a few issues (noted below).
5. Manually copy in all the images from the **0 — attachments** directory.
6. Modify the `compile` script (see below).
7. Make and run a Julia script to bring everything together.

## Required changes

TeX fails when code blocks' lines are too long, or when there are too many lines. You'll have to manually remove the raw lldb `print` output as reproduced towards the end of [0601 Sample OpenCV C++ square detection code and its output](0601%20Sample%20OpenCV%20C++%20square%20detection%20code%20and%20its%20output.md) for this reason.

## Compile script

Mostly the same, but certain things can be omitted. Try the following.

```zsh
#!/bin/zsh
# run this script instead of trying to run the Pandoc command directly.
# If you customise this you can get some really good and fairly robust workflows going.

set -e

clear
echo "Beginning export at $(date +"%H:%M:%S")..."

# render the markdown
pandoc -s main.md -o export.pdf                                 \
    --template="template/modpandoc.tex"                         \
    --highlight-style="template/code.theme"                     \
    --pdf-engine=xelatex                                        \
    --toc-depth=2                                               \
    --toc                                                       \
    --dpi=300                                                   \
    --variable fontsize="11pt"                                  \
    --variable numbersections=true                              \
    --variable toc-name="Table of Contents"                     \
\
    --variable title-meta="Sam's logbook"                       \
    --variable title="Sam's Logbook"                            \
    --variable subtitle="Part IV Project 83"                    \
    --variable author-meta="Sam Skinner"                        \
    --variable author="Sam Skinner (sski596)"                   \
    --variable date="$(date +"%A %d %b '%y")"                   \
\
    --variable header-includes="\\input{template/style.tex}"    \
\
    --lua-filter template/include-files.lua                     \

echo "Export complete."
echo "Archiving a copy..."

# commit the changes (suppress output)
git add main.md
git commit -m "[auto] post-render commit" > /dev/null

# copy the pdf to an archives folder
mkdir -p "Previous Versions"
cp export.pdf "Previous Versions/$(date +"%a %d %b %y at %H.%M") ($(git rev-parse --short HEAD)).pdf"

echo "All done at $(date +"%H:%M:%S")."

echo
git status
echo

```

## Julia script

````julia
rm("main.md", force=true)
markdownfiles = split(strip(read(pipeline(`ls`, `grep '.md'`), String)), "\n")
println.(markdownfiles)

# for fname in markdownfiles
# 	write("folded$fname", read(`fold -s -w50 $fname`, String))
# end

names = map(fname -> split(fname, ".md")[1], markdownfiles)

mainmd = """
% This file is autogenerated by make.jl
% Bear this in mind if you decide to edit it directly…

"""

imports = [markdownfiles names]

for log in eachrow(imports)

	global mainmd *= """
# $(log[2])

```{.include shift-heading-level-by=1}
$(log[1])
```

"""
# folded$(log[1])
end

write("main.md", mainmd)

run(`./compile`)
````